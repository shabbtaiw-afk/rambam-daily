<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专"  |  砖 砖</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&family=Heebo:wght@300;500;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d; /*  注拽 转专 */
            --accent: #d4af37;  /*  */
            --success: #2d6a4f;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Assistant', 'Heebo', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-family: 'Heebo';
            font-weight: 800;
            color: var(--primary);
            margin: 0;
            letter-spacing: -1px;
        }

        /* 驻住 转拽转 砖专 */
        .progress-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .bar-container {
            height: 12px;
            background: #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            margin-top: 15px;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
        }

        /*  */
        .nav-card {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        select {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid #cbd5e1;
            background: white;
            font-size: 14px;
            margin-bottom: 10px;
            outline: none;
            transition: border-color 0.2s;
        }

        select:focus {
            border-color: var(--accent);
        }

        .btn-today {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
        }

        .btn-today:active {
            transform: scale(0.98);
        }

        /* 专砖转 驻专拽 */
        .list-section {
            background: white;
            border-radius: 24px;
            padding: 10px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .list-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-title {
            font-weight: 700;
            color: var(--primary);
        }

        .chapter-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 16px;
            margin-bottom: 5px;
            transition: background 0.3s;
        }

        .chapter-item.completed {
            background: #f0fdf4;
            opacity: 0.8;
        }

        .chapter-item.is-target {
            border: 2px solid var(--accent);
            background: #fffbeb;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-left: 15px;
            cursor: pointer;
            accent-color: var(--success);
        }

        .chapter-label {
            font-size: 17px;
            flex-grow: 1;
        }

        .badge-today {
            background: var(--accent);
            color: white;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
        }

        /* 驻转专 驻注  */
        .bottom-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .btn-action {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-size: 13px;
        }

        /* 专 专转 住转专 */
        #settingsArea {
            display: none;
            background: #fff;
            padding: 20px;
            border-radius: 20px;
            margin-top: 15px;
            border: 1px solid #eee;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>砖 转专</h1>
        <div style="font-size: 14px; color: #64748b; margin-top: 5px;">住专 专" </div>
    </header>

    <div class="progress-card">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">住驻拽 </div>
                <div class="stat-value" id="progressNum">0/1000</div>
            </div>
            <div class="stat-item">
                <div class="stat-label"> </div>
                <div class="stat-value" id="dayNum">--</div>
            </div>
        </div>
        <div class="bar-container">
            <div class="bar-fill" id="progressBar"></div>
        </div>
    </div>

    <div id="gapIndicator" style="text-align: center; font-weight: bold; margin-bottom: 15px; padding: 10px; border-radius: 12px;"></div>

    <div class="nav-card">
        <div class="nav-row">
            <select id="bookSelect" onchange="updateHalachaList()"></select>
            <select id="halachaSelect" onchange="render()"></select>
        </div>
        <button class="btn-today" onclick="jumpToToday()">驻  专 转 ?</button>
    </div>

    <div class="list-section">
        <div class="list-header">
            <span class="list-title" id="viewTitle">注...</span>
            <button class="btn-bulk" style="background:none; border:none; color:var(--primary); cursor:pointer; font-weight:700; font-size:12px;" onclick="markHalachaDone()">住 砖  V</button>
        </div>
        <div id="chapterList"></div>
    </div>

    <div class="bottom-actions">
        <button class="btn-action" onclick="toggleSettings()">锔 专转 住专</button>
        <button class="btn-action" onclick="exportData()">  转</button>
    </div>

    <div id="settingsArea">
        <h3 style="margin-top:0;">住专 砖 驻</h3>
        <p style="font-size:12px;">专 驻 转 爪 <b></b> 砖  转 转专 转:</p>
        <select id="syncBookSelect" onchange="updateSyncHalachot()"></select>
        <select id="syncHalachaSelect"></select>
        <input type="number" id="syncPerekInput" placeholder="住驻专 驻专拽" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; margin-bottom:10px; box-sizing:border-box;">
        <button class="btn-today" style="background:var(--accent);" onclick="syncDateFromLocation()">爪注 砖 住专</button>
        
        <hr style="margin:20px 0; opacity:0.1;">
        
        <label style="font-size:12px; font-weight:bold;">拽爪  (驻专拽 ):</label>
        <input type="number" id="paceInput" value="1" min="1" onchange="updatePace(this.value)" style="width:100%; padding:8px; margin-bottom:10px;">
        
        <label style="font-size:12px; font-weight:bold;">转专 转转 住:</label>
        <input type="date" id="dateInput" onchange="updateStartDate(this.value)" style="width:100%; padding:8px;">
    </div>
</div>

<script>
    // 转  专" (拽爪专 爪专 , 住祝 转  砖专 -rambamData)
    const rambamData = [
        { b: "注", h: "住 转专", c: 10 }, { b: "注", h: "注转", c: 7 }, { b: "注", h: "转 转专", c: 7 }, { b: "注", h: "注 专", c: 12 }, { b: "注", h: "转砖", c: 10 },
        { b: "", h: "拽专转 砖注", c: 4 }, { b: "", h: "转驻", c: 15 }, { b: "", h: "转驻", c: 10 }, { b: "", h: "爪爪转", c: 3 }, { b: "", h: "专转", c: 11 }, { b: "", h: "", c: 3 },
        { b: "", h: "砖转", c: 30 }, { b: "", h: "注专", c: 8 }, { b: "", h: "砖转转 注砖专", c: 3 }, { b: "", h: "砖转转 \"", c: 8 }, { b: "", h: "抓 爪", c: 8 }, { b: "", h: "砖驻专 住", c: 8 }, { b: "", h: "砖拽", c: 4 }, { b: "", h: "拽砖 砖", c: 19 }, { b: "", h: "转注转", c: 5 }, { b: "", h: " ", c: 4 }
    ];

    function getGematria(n) {
        if (n <= 0) return "";
        let l = { 400:'转', 300:'砖', 200:'专', 100:'拽', 90:'爪', 80:'驻', 70:'注', 60:'住', 50:'', 40:'', 30:'', 20:'', 10:'', 9:'', 8:'', 7:'', 6:'', 5:'', 4:'', 3:'', 2:'', 1:'' };
        if (n===15) return "\""; if (n===16) return "\"";
        let r = ''; let keys = Object.keys(l).map(Number).sort((a,b)=>b-a);
        for(let k of keys) { while(n>=k) { r+=l[k]; n-=k; } }
        return r.length === 1 ? r + "'" : r.slice(0,-1) + '"' + r.slice(-1);
    }

    let completed = JSON.parse(localStorage.getItem('rambamDone')) || [];
    let pace = parseInt(localStorage.getItem('rambamPace')) || 1;

    window.onload = function() {
        if (!localStorage.getItem('rambamStart')) localStorage.setItem('rambamStart', '2026-01-16');
        initSelectors();
        jumpToToday();
    };

    function initSelectors() {
        const books = [...new Set(rambamData.map(i => i.b))];
        const selects = [document.getElementById('bookSelect'), document.getElementById('syncBookSelect')];
        selects.forEach(s => {
            books.forEach(b => {
                let o = document.createElement('option'); o.value = b; o.text = "住驻专 " + b; s.add(o);
            });
        });
        updateHalachaList();
        updateSyncHalachot();
    }

    function updateHalachaList() {
        const b = document.getElementById('bookSelect').value;
        const hSel = document.getElementById('halachaSelect'); hSel.innerHTML = "";
        rambamData.filter(i => i.b === b).forEach(i => {
            let o = document.createElement('option'); o.value = i.h; o.text = "转 " + i.h; hSel.add(o);
        });
        render();
    }

    function updateSyncHalachot() {
        const b = document.getElementById('syncBookSelect').value;
        const hSel = document.getElementById('syncHalachaSelect'); hSel.innerHTML = "";
        rambamData.filter(i => i.b === b).forEach(i => {
            let o = document.createElement('option'); o.value = i.h; o.text = "转 " + i.h; hSel.add(o);
        });
    }

    function jumpToToday() {
        const start = new Date(localStorage.getItem('rambamStart'));
        const today = new Date(); start.setHours(0,0,0,0); today.setHours(0,0,0,0);
        const targetIdx = (Math.floor((today - start) / 86400000) * pace) + 1;
        let count = 0;
        for (let item of rambamData) {
            if (targetIdx <= count + item.c) {
                document.getElementById('bookSelect').value = item.b;
                updateHalachaList();
                document.getElementById('halachaSelect').value = item.h;
                break;
            }
            count += item.c;
        }
        render();
    }

    function syncDateFromLocation() {
        const b = document.getElementById('syncBookSelect').value;
        const h = document.getElementById('syncHalachaSelect').value;
        const p = parseInt(document.getElementById('syncPerekInput').value) || 1;
        let globalIdx = 0;
        for (let item of rambamData) {
            if (item.b === b && item.h === h) { globalIdx += p; break; }
            globalIdx += item.c;
        }
        const daysReq = Math.ceil((globalIdx - 1) / pace);
        const today = new Date(); today.setDate(today.getDate() - daysReq);
        localStorage.setItem('rambamStart', today.toISOString().split('T')[0]);
        location.reload();
    }

    function render() {
        const start = new Date(localStorage.getItem('rambamStart'));
        const today = new Date(); start.setHours(0,0,0,0); today.setHours(0,0,0,0);
        const diffDays = Math.floor((today - start) / 86400000);
        const targetIdx = (diffDays * pace) + 1;

        document.getElementById('dayNum').innerText = diffDays + 1;
        document.getElementById('progressNum').innerText = completed.length + "/1000";
        document.getElementById('progressBar').style.width = (completed.length / 10) + "%";
        
        const missing = targetIdx - completed.length;
        const gapEl = document.getElementById('gapIndicator');
        if(missing > 0) {
            gapEl.innerText = `驻专 砖 ${missing} 驻专拽 转转`;
            gapEl.style.background = "#fee2e2"; gapEl.style.color = "#b91c1c";
        } else {
            gapEl.innerText = missing < 0 ? `拽 砖 ${Math.abs(missing)} 驻专拽!` : "拽爪 拽! 砖专";
            gapEl.style.background = "#f0fdf4"; gapEl.style.color = "#15803d";
        }

        const selB = document.getElementById('bookSelect').value;
        const selH = document.getElementById('halachaSelect').value;
        document.getElementById('viewTitle').innerText = selH;

        let html = ""; let gCount = 0;
        for (let item of rambamData) {
            if (item.b === selB && item.h === selH) {
                for (let i = 1; i <= item.c; i++) {
                    const idx = gCount + i;
                    const isDone = completed.includes(idx);
                    const isTarget = idx >= targetIdx && idx < targetIdx + pace;
                    html += `
                        <div class="chapter-item ${isDone ? 'completed' : ''} ${isTarget ? 'is-target' : ''}">
                            <input type="checkbox" ${isDone ? 'checked' : ''} onclick="toggleCheck(${idx})">
                            <span class="chapter-label">驻专拽 ${getGematria(i)}</span>
                            ${isTarget ? '<span class="badge-today"></span>' : ''}
                        </div>`;
                }
                break;
            }
            gCount += item.c;
        }
        document.getElementById('chapterList').innerHTML = html;
    }

    function toggleCheck(idx) {
        let p = completed.indexOf(idx);
        if(p > -1) completed.splice(p, 1); else completed.push(idx);
        localStorage.setItem('rambamDone', JSON.stringify(completed));
        render();
    }

    function markHalachaDone() {
        const b = document.getElementById('bookSelect').value;
        const h = document.getElementById('halachaSelect').value;
        if(!confirm("住 ?")) return;
        let gIdx = 0;
        rambamData.forEach(item => {
            for(let i=1; i<=item.c; i++) {
                gIdx++;
                if(item.b === b && item.h === h && !completed.includes(gIdx)) completed.push(gIdx);
            }
        });
        localStorage.setItem('rambamDone', JSON.stringify(completed));
        render();
    }

    function toggleSettings() { let s = document.getElementById('settingsArea').style; s.display = s.display === 'block' ? 'none' : 'block'; }
    function exportData() {
        const d = { start: localStorage.getItem('rambamStart'), done: completed, pace: pace };
        const b = new Blob([JSON.stringify(d)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'rambam_backup.json'; a.click();
    }
</script>
</body>
</html>
