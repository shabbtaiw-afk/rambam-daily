<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רמב"ם יומי - צ'ק ליסט חכם</title>
    <style>
        :root { --primary: #2c3e50; --accent: #27ae60; --target: #3498db; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .card { background: white; width: 100%; max-width: 480px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; border-top: 8px solid var(--accent); }
        h1 { color: var(--primary); margin-bottom: 5px; font-size: 24px; }
        
        .summary-box { margin: 20px 0; padding: 15px; background: #f8fafc; border-radius: 12px; font-size: 15px; color: #475569; border: 1px solid #e2e8f0; }
        .summary-box b { color: var(--primary); }

        .checklist { text-align: right; margin-top: 20px; max-height: 400px; overflow-y: auto; padding: 5px; }
        .chapter-item { display: flex; align-items: center; padding: 12px; margin-bottom: 8px; background: #fff; border: 1px solid #edf2f7; border-radius: 10px; transition: 0.2s; }
        .chapter-item.is-target { border: 2px solid var(--target); background: #f0f9ff; }
        .chapter-item.completed { background: #f0fdf4; border-color: #bbf7d0; }
        
        input[type="checkbox"] { width: 22px; height: 22px; cursor: pointer; margin-left: 15px; accent-color: var(--accent); }
        .chapter-label { flex-grow: 1; font-size: 17px; font-weight: 500; }
        .target-badge { font-size: 11px; background: var(--target); color: white; padding: 2px 8px; border-radius: 10px; margin-right: 10px; }

        .settings-toggle { color: var(--accent); cursor: pointer; font-size: 13px; text-decoration: underline; margin-top: 15px; display: inline-block; }
        .settings-area { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; text-align: right; }
        label { display: block; font-size: 12px; font-weight: bold; color: #64748b; margin-bottom: 5px; }
        input[type="date"] { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 15px; margin-bottom: 10px; }
        button { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }
    </style>
</head>
<body>

<div class="card">
    <h1>מעקב רמב"ם יומי</h1>
    
    <div class="summary-box">
        <div>היום: <b>יום <span id="currentDayNum"></span></b> ללימוד</div>
        <div>יעד להיום: <b id="targetText">--</b></div>
        <div>הספקת: <b id="progressText">0/1000</b> פרקים</div>
    </div>

    <div id="checklistTitle" style="text-align: right; font-weight: bold; color: var(--primary); margin-top: 10px;"></div>
    <div id="chapterList" class="checklist">
        </div>

    <span class="settings-toggle" onclick="toggleSettings()">הגדרות תאריך התחלה</span>
    <div id="settingsArea" class="settings-area">
        <label>שנה תאריך התחלה:</label>
        <input type="date" id="dateInput" onchange="updateDate(this.value)">
    </div>
</div>

<script>
    // מפת רמב"ם מלאה
    const rambamData = [
        { b: "המדע", h: "יסודי התורה", c: 10 }, { b: "המדע", h: "דעות", c: 7 }, { b: "המדע", h: "תלמוד תורה", c: 7 }, { b: "המדע", h: "עבודה זרה", c: 12 }, { b: "המדע", h: "תשובה", c: 10 },
        { b: "אהבה", h: "קריאת שמע", c: 4 }, { b: "אהבה", h: "תפילה", c: 15 }, { b: "אהבה", h: "תפילין", c: 10 }, { b: "אהבה", h: "ציצית", c: 3 }, { b: "אהבה", h: "ברכות", c: 11 }, { b: "אהבה", h: "מילה", c: 3 },
        { b: "זמנים", h: "שבת", c: 30 }, { b: "זמנים", h: "עירובין", c: 8 }, { b: "זמנים", h: "שביתת עשור", c: 3 }, { b: "זמנים", h: "שביתת יו\"ט", c: 8 }, { b: "זמנים", h: "חמץ ומצה", c: 8 }, { b: "זמנים", h: "שופר וסוכה", c: 8 }, { b: "זמנים", h: "שקלים", c: 4 }, { b: "זמנים", h: "קידוש החודש", c: 19 }, { b: "זמנים", h: "תעניות", c: 5 }, { b: "זמנים", h: "מגילה וחנוכה", c: 4 },
        { b: "נשים", h: "אישות", c: 25 }, { b: "נשים", h: "גירושין", c: 13 }, { b: "נשים", h: "יבום וחליצה", c: 4 }, { b: "נשים", h: "נערה בתולה", c: 3 }, { b: "נשים", h: "סוטה", c: 4 },
        { b: "קדושה", h: "איסורי ביאה", c: 22 }, { b: "קדושה", h: "מאכלות אסורות", c: 17 }, { b: "קדושה", h: "שחיטה", c: 14 },
        { b: "הפלאה", h: "שבועות", c: 12 }, { b: "הפלאה", h: "נדרים", c: 13 }, { b: "הפלאה", h: "נזירות", c: 10 }, { b: "הפלאה", h: "ערכין וחרמין", c: 8 },
        { b: "זרעים", h: "כלאיים", c: 10 }, { b: "זרעים", h: "מתנות עניים", c: 10 }, { b: "זרעים", h: "תרומות", c: 15 }, { b: "זרעים", h: "מעשר", c: 14 }, { b: "זרעים", h: "מעשר שני", c: 11 }, { b: "זרעים", h: "ביכורים", c: 12 }, { b: "זרעים", h: "שמיטה ויובל", c: 13 },
        { b: "עבודה", h: "בית הבחירה", c: 8 }, { b: "עבודה", h: "כלי המקדש", c: 10 }, { b: "עבודה", h: "ביאת המקדש", c: 9 }, { b: "עבודה", h: "איסורי מזבח", c: 7 }, { b: "עבודה", h: "מעשה הקרבנות", c: 19 }, { b: "עבודה", h: "תמידין ומוספין", c: 10 }, { b: "עבודה", h: "פסולי המוקדשין", c: 19 }, { b: "עבודה", h: "עבודת יוה\"כ", c: 5 }, { b: "עבודה", h: "מעילה", c: 8 },
        { b: "קרבנות", h: "קרבן פסח", c: 10 }, { b: "קרבנות", h: "חגיגה", c: 3 }, { b: "קרבנות", h: "בכורות", c: 8 }, { b: "קרבנות", h: "שגגות", c: 15 }, { b: "קרבנות", h: "מחוסרי כפרה", c: 5 }, { b: "קרבנות", h: "תמורה", c: 4 },
        { b: "טהרה", h: "טומאת מת", c: 25 }, { b: "טהרה", h: "פרה אדומה", c: 15 }, { b: "טהרה", h: "טומאת צרעת", c: 16 }, { b: "טהרה", h: "מטמאי משכב", c: 13 }, { b: "טהרה", h: "שאר אבות הטומאות", c: 20 }, { b: "טהרה", h: "טומאת אוכלין", c: 16 }, { b: "טהרה", h: "כלים", c: 28 }, { b: "טהרה", h: "מקואות", c: 11 },
        { b: "נזיקין", h: "נזקי ממון", c: 14 }, { b: "נזיקין", h: "גניבה", c: 9 }, { b: "נזיקין", h: "גזילה ואבידה", c: 18 }, { b: "נזיקין", h: "חובל ומזיק", c: 8 }, { b: "נזיקין", h: "רוצח ושמירת נפש", c: 13 },
        { b: "קניין", h: "מכירה", c: 30 }, { b: "קניין", h: "זכייה ומתנה", c: 12 }, { b: "קניין", h: "שכנים", c: 14 }, { b: "קניין", h: "שותפין", c: 10 }, { b: "קניין", h: "עבדים", c: 9 },
        { b: "משפטים", h: "שכירות", c: 13 }, { b: "משפטים", h: "שאלה ופיקדון", c: 8 }, { b: "משפטים", h: "מלווה ולווה", c: 27 }, { b: "משפטים", h: "טוען ונטען", c: 16 }, { b: "משפטים", h: "נחלות", c: 11 },
        { b: "שופטים", h: "סנהדרין", c: 26 }, { b: "שופטים", h: "עדות", c: 22 }, { b: "שופטים", h: "ממרים", c: 7 }, { b: "שופטים", h: "אבל", c: 14 }, { b: "שופטים", h: "מלכים ומלחמות", c: 12 }
    ];

    function getGematria(num) {
        if (num <= 0) return "";
        let letters = { 400: 'ת', 300: 'ש', 200: 'ר', 100: 'ק', 90: 'צ', 80: 'פ', 70: 'ע', 60: 'ס', 50: 'נ', 40: 'מ', 30: 'ל', 20: 'כ', 10: 'י', 9: 'ט', 8: 'ח', 7: 'ז', 6: 'ו', 5: 'ה', 4: 'ד', 3: 'ג', 2: 'ב', 1: 'א' };
        if (num === 15) return "ט\"ו"; if (num === 16) return "ט\"ז";
        let res = '';
        let keys = Object.keys(letters).map(Number).sort((a,b)=>b-a);
        for(let k of keys) { while(num>=k) { res+=letters[k]; num-=k; } }
        return res.length === 1 ? res + "'" : res.slice(0,-1) + '"' + res.slice(-1);
    }

    let completed = JSON.parse(localStorage.getItem('rambamDone')) || [];

    window.onload = function() {
        const saved = localStorage.getItem('rambamStart');
        if (saved) {
            document.getElementById('dateInput').value = saved;
            render();
        } else {
            toggleSettings();
        }
    };

    function toggleSettings() {
        let s = document.getElementById('settingsArea').style;
        s.display = s.display === 'block' ? 'none' : 'block';
    }

    function updateDate(val) {
        localStorage.setItem('rambamStart', val);
        render();
    }

    function toggleCheck(idx) {
        let pos = completed.indexOf(idx);
        if (pos > -1) completed.splice(pos, 1);
        else completed.push(idx);
        localStorage.setItem('rambamDone', JSON.stringify(completed));
        render();
    }

    function render() {
        const start = new Date(localStorage.getItem('rambamStart'));
        const today = new Date();
        start.setHours(0,0,0,0); today.setHours(0,0,0,0);
        
        const diffDays = Math.floor((today - start) / (86400000));
        const targetIdx = (diffDays % 1000) + 1;
        
        document.getElementById('currentDayNum').innerText = diffDays + 1;
        document.getElementById('progressText').innerText = completed.length + "/1000";

        let currentCount = 0;
        let targetUnit = null;

        for (let item of rambamData) {
            if (targetIdx <= currentCount + item.c) {
                targetUnit = item;
                const pInH = targetIdx - currentCount;
                document.getElementById('targetText').innerText = `הל' ${item.h} פרק ${getGematria(pInH)}`;
                document.getElementById('checklistTitle').innerText = `הלכות ${item.h}:`;
                
                // יצירת הרשימה
                let html = "";
                for (let i = 1; i <= item.c; i++) {
                    const globalIdx = currentCount + i;
                    const isDone = completed.includes(globalIdx);
                    const isTarget = globalIdx === targetIdx;
                    
                    html += `
                        <div class="chapter-item ${isDone ? 'completed' : ''} ${isTarget ? 'is-target' : ''}">
                            <input type="checkbox" ${isDone ? 'checked' : ''} onclick="toggleCheck(${globalIdx})">
                            <span class="chapter-label">פרק ${getGematria(i)}</span>
                            ${isTarget ? '<span class="target-badge">היעד להיום</span>' : ''}
                        </div>
                    `;
                }
                document.getElementById('chapterList').innerHTML = html;
                break;
            }
            currentCount += item.c;
        }
    }
</script>

</body>
</html>
