<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专"  |  砖 砖</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a365d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&family=Heebo:wght@300;500;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a365d; --accent: #d4af37; --success: #2d6a4f; --danger: #e74c3c; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Assistant', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; margin-top: 10px; }
        header { text-align: center; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { font-family: 'Heebo'; font-weight: 800; color: var(--primary); margin: 0; }
        .card { background: white; padding: 20px; border-radius: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #eee; }
        .bar-container { height: 12px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin: 15px 0; position: relative; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 0.8s ease; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        .stat-val { font-size: 18px; font-weight: 700; color: var(--primary); }
        .stat-lab { font-size: 11px; color: #64748b; }
        select, input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #cbd5e1; margin-bottom: 8px; font-family: inherit; background: #fff; outline: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; margin-top: 5px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .checklist { max-height: 320px; overflow-y: auto; border: 1px solid #f1f5f9; border-radius: 15px; padding: 5px; }
        .chapter-item { display: flex; align-items: center; padding: 12px; border-radius: 10px; margin-bottom: 4px; }
        .chapter-item.completed { background: #f0fdf4; }
        .chapter-item.is-target { border: 2px solid var(--accent); background: #fffbeb; }
        input[type="checkbox"] { width: 22px; height: 22px; margin-left: 12px; accent-color: var(--success); cursor: pointer; }
        .chapter-label { flex-grow: 1; font-size: 17px; font-weight: 500; }
        .btn-learn { background: none; border: 1.5px solid var(--accent); color: var(--accent); padding: 5px 10px; border-radius: 8px; font-size: 12px; font-weight: 700; cursor: pointer; text-decoration: none; }
        .settings-toggle-btn { background: none; border: 1px solid #cbd5e1; color: #64748b; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; margin: 10px auto 30px; }
        .settings-area { display: none; background: #fdfdfd; border: 1px solid #e2e8f0; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .settings-section-title { font-size: 14px; font-weight: 800; color: var(--primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .setting-row { margin-bottom: 15px; padding: 10px; background: #fff; border-radius: 12px; border: 1px solid #f1f5f9; }
        label { font-size: 11px; font-weight: 700; color: #64748b; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <svg width="50" height="50" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 5px;">
            <path d="M12 21C12 21 11 19 3 19V5C11 5 12 7 12 7M12 21C12 21 13 19 21 19V5C13 5 12 7 12 7M12 21V7" stroke="#d4af37" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h1>砖 转专</h1>
    </header>

    <div class="card">
        <div class="stats">
            <div class="stat-item"><span class="stat-lab"> </span><span class="stat-val" id="dayDisplay">--</span></div>
            <div class="stat-item"><span class="stat-lab">住驻拽 (驻专拽)</span><span class="stat-val" id="totalDisplay">0/1000</span></div>
        </div>
        <div class="bar-container"><div class="bar-fill" id="progressBar"></div></div>
        <div id="gapMsg" style="font-size: 13px; text-align: center; font-weight: 700;"></div>
    </div>

    <div class="card" style="background: #f1f5f9; border: none;">
        <div style="display: flex; gap: 5px; margin-bottom: 10px;">
            <select id="bookSelect" onchange="updateHalacha()"></select>
            <select id="halachaSelect" onchange="render()"></select>
        </div>
        <button class="btn" onclick="jumpToToday()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            拽驻抓 注 砖 
        </button>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <b id="listTitle" style="color:var(--primary); font-size: 18px;">转</b>
            <button onclick="markAllDone()" style="background:none; border:none; color:var(--primary); font-weight:700; cursor:pointer; font-size:12px; text-decoration: underline;">住 砖 V</button>
        </div>
        <div id="chapterList" class="checklist"></div>
    </div>

    <button class="settings-toggle-btn" onclick="toggleSettings()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        专转 住专 转转
    </button>

    <div id="settings" class="card settings-area">
        <div class="settings-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
            转专转 转
        </div>
        <div class="setting-row">
            <label>拽 转专 砖注:</label>
            <input type="time" id="reminderTime" onchange="updateReminderTime(this.value)">
            <button class="btn" style="background:var(--success); font-size: 12px;" onclick="requestNotificationPermission()">
                 驻注 转专转 砖专 
            </button>
        </div>

        <div class="settings-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            住专 拽 (砖 驻)
        </div>
        <div class="setting-row">
            <select id="syncBook" onchange="updateSyncHalacha()"></select>
            <select id="syncHalacha" onchange="updateSyncPerekList()"></select>
            <select id="syncPerekSelect" style="margin-bottom: 12px;"></select>
            <button class="btn" style="background:var(--accent);" onclick="syncFromLocation()">注 转专 驻 拽 砖</button>
        </div>

        <div class="settings-section-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            专转 
        </div>
        <div class="setting-row">
            <label>拽爪 (驻专拽 ):</label>
            <input type="number" id="paceInput" value="1" min="1" onchange="updatePace(this.value)">
            <label style="margin-top: 10px;">转专 转 :</label>
            <input type="date" id="dateInput" onchange="updateStartDate(this.value)">
        </div>
        
        <button class="btn" style="background:#64748b;" onclick="exportData()">  转 拽抓</button>
    </div>
</div>

<script>
    const rambamData = [
        { b: "注", h: "住 转专", c: 10, s: "Foundations_of_the_Torah" }, { b: "注", h: "注转", c: 7, s: "Ethical_Ideas" }, { b: "注", h: "转 转专", c: 7, s: "Study_of_the_Torah" }, { b: "注", h: "注 专", c: 12, s: "Foreign_Worship_and_Customs_of_the_Nations" }, { b: "注", h: "转砖", c: 10, s: "Repentance" },
        { b: "", h: "拽专转 砖注", c: 4, s: "Reading_the_Shema" }, { b: "", h: "转驻", c: 15, s: "Prayer_and_the_Priestly_Blessing" }, { b: "", h: "转驻", c: 10, s: "Tefillin,_Mezuzah_and_the_Torah_Scroll" }, { b: "", h: "爪爪转", c: 3, s: "Fringes" }, { b: "", h: "专转", c: 11, s: "Blessings" }, { b: "", h: "", c: 3, s: "Circumcision" },
        { b: "", h: "砖转", c: 30, s: "Sabbath" }, { b: "", h: "注专", c: 8, s: "Eruvin" }, { b: "", h: "砖转转 注砖专", c: 3, s: "Rest_on_the_Tenth" }, { b: "", h: "砖转转 \"", c: 8, s: "Rest_on_a_Holiday" }, { b: "", h: "抓 爪", c: 8, s: "Leavened_and_Unleavened_Bread" }, { b: "", h: "砖驻专 住", c: 8, s: "Shofar,_Sukkah_and_Lulav" }, { b: "", h: "砖拽", c: 4, s: "Levying_of_Half-Shekels" }, { b: "", h: "拽砖 砖", c: 19, s: "Sanctification_of_the_New_Month" }, { b: "", h: "转注转", c: 5, s: "Fasts" }, { b: "", h: " ", c: 4, s: "Megillah_and_Hanukkah" },
        { b: "砖", h: "砖转", c: 25, s: "Marriage" }, { b: "砖", h: "专砖", c: 13, s: "Divorce" }, { b: "砖", h: " 爪", c: 20, s: "Levirate_Marriage_and_Release" }, { b: "砖", h: "注专 转", c: 3, s: "Virgin_Maiden" }, { b: "砖", h: "住", c: 4, s: "Woman_Suspected_of_Infidelity" },
        { b: "拽砖", h: "住专 ", c: 22, s: "Forbidden_Intercourse" }, { b: "拽砖", h: "转 住专转", c: 17, s: "Forbidden_Foods" }, { b: "拽砖", h: "砖", c: 14, s: "Ritual_Slaughter" },
        { b: "驻", h: "砖注转", c: 12, s: "Oaths" }, { b: "驻", h: "专", c: 13, s: "Vows" }, { b: "驻", h: "专转", c: 10, s: "Nazirite_Vows" }, { b: "驻", h: "注专 专", c: 8, s: "Valuations_and_Devoted_Property" },
        { b: "专注", h: "", c: 10, s: "Mixtures" }, { b: "专注", h: "转转 注", c: 10, s: "Gifts_to_the_Poor" }, { b: "专注", h: "转专转", c: 15, s: "Heave_Offerings" }, { b: "专注", h: "注砖专", c: 14, s: "Tithes" }, { b: "专注", h: "注砖专 砖", c: 11, s: "Second_Tithes_and_Fourth_Year's_Fruit" }, { b: "专注", h: "专", c: 12, s: "First_Fruits_and_other_Gifts_to_the_Priesthood_in_the_Territories" }, { b: "专注", h: "砖 ", c: 13, s: "Sabbatical_and_Jubilee_Years" },
        { b: "注", h: "转 专", c: 8, s: "The_Chosen_Temple" }, { b: "注", h: " 拽砖", c: 10, s: "Vessels_of_the_Sanctuary_and_Those_who_Serve_Therein" }, { b: "注", h: "转 拽砖", c: 9, s: "Entrance_into_the_Sanctuary" }, { b: "注", h: "住专 ", c: 7, s: "Things_Forbidden_offered_upon_the_Altar" }, { b: "注", h: "注砖 拽专转", c: 19, s: "Sacrificial_Procedure" }, { b: "注", h: "转 住驻", c: 10, s: "Daily_Offerings_and_Additional_Offerings" }, { b: "注", h: "驻住 拽砖", c: 19, s: "Disqualified_Consecrated_Offerings" }, { b: "注", h: "注转 \"", c: 5, s: "Service_of_the_Day_of_Atonement" }, { b: "注", h: "注", c: 8, s: "Trespass" },
        { b: "拽专转", h: "拽专 驻住", c: 10, s: "Paschal_Offering" }, { b: "拽专转", h: "", c: 3, s: "Festival_Offering" }, { b: "拽专转", h: "专转", c: 8, s: "Firstborns" }, { b: "拽专转", h: "砖转", c: 15, s: "Offerings_for_Unintentional_Transgressions" }, { b: "拽专转", h: "住专 驻专", c: 5, s: "Those_Whose_Atonement_is_Incomplete" }, { b: "拽专转", h: "转专", c: 4, s: "Substitution" },
        { b: "专", h: "转 转", c: 25, s: "Uncleanness_of_the_Dead" }, { b: "专", h: "驻专 ", c: 15, s: "Red_Heifer" }, { b: "专", h: "转 爪专注转", c: 16, s: "Uncleanness_of_Leprosy" }, { b: "专", h: " 砖", c: 13, s: "Those_Who_Defile_Bed_or_Seat" }, { b: "专", h: "砖专 转 转", c: 20, s: "Other_Primary_Sources_of_Uncleanness" }, { b: "专", h: "转 ", c: 16, s: "Uncleanness_of_Foodstuffs" }, { b: "专", h: "", c: 28, s: "Vessels" }, { b: "专", h: "拽转", c: 11, s: "Immersion_Pools" },
        { b: "拽", h: "拽 ", c: 14, s: "Damages_to_Property" }, { b: "拽", h: "", c: 9, s: "Theft" }, { b: "拽", h: " ", c: 18, s: "Robbery_and_Lost_Property" }, { b: "拽", h: " 拽", c: 8, s: "One_Who_Injures_a_Person_or_Damages_Property" }, { b: "拽", h: "专爪 砖专转 驻砖", c: 13, s: "Murder_and_the_Preservation_of_Life" },
        { b: "拽", h: "专", c: 30, s: "Sales" }, { b: "拽", h: " 转", c: 12, s: "Original_Acquisition_and_Gifts" }, { b: "拽", h: "砖", c: 14, s: "Neighbors" }, { b: "拽", h: "砖转驻", c: 10, s: "Partners" }, { b: "拽", h: "注", c: 9, s: "Slaves" },
        { b: "砖驻", h: "砖专转", c: 13, s: "Hiring" }, { b: "砖驻", h: "砖 驻拽", c: 8, s: "Borrowing_and_Deposit" }, { b: "砖驻", h: " ", c: 27, s: "Creditor_and_Debtor" }, { b: "砖驻", h: "注 注", c: 16, s: "Plaintiff_and_Defendant" }, { b: "砖驻", h: "转", c: 11, s: "Inheritances" },
        { b: "砖驻", h: "住专", c: 26, s: "The_Sanhedrin_and_the_Penalties_within_their_Jurisdiction" }, { b: "砖驻", h: "注转", c: 22, s: "Testimony" }, { b: "砖驻", h: "专", c: 7, s: "Rebels" }, { b: "砖驻", h: "", c: 14, s: "Mourning" }, { b: "砖驻", h: " 转", c: 12, s: "Kings_and_Wars" }
    ];

    function getGematria(n) {
        if (n <= 0) return "";
        let l = { 400:'转', 300:'砖', 200:'专', 100:'拽', 90:'爪', 80:'驻', 70:'注', 60:'住', 50:'', 40:'', 30:'', 20:'', 10:'', 9:'', 8:'', 7:'', 6:'', 5:'', 4:'', 3:'', 2:'', 1:'' };
        if (n===15) return "\""; if (n===16) return "\"";
        let r = ''; let keys = Object.keys(l).map(Number).sort((a,b)=>b-a);
        for(let k of keys) { while(n>=k) { r+=l[k]; n-=k; } }
        return r.length === 1 ? r + "'" : r.slice(0,-1) + '"' + r.slice(-1);
    }

    let completed = JSON.parse(localStorage.getItem('rambamDone')) || [];
    let pace = parseInt(localStorage.getItem('rambamPace')) || 1;
    let reminderTime = localStorage.getItem('rambamReminder') || "";

    window.onload = function() {
        if (!localStorage.getItem('rambamStart')) localStorage.setItem('rambamStart', '2026-01-16');
        document.getElementById('dateInput').value = localStorage.getItem('rambamStart');
        document.getElementById('reminderTime').value = reminderTime;
        init(); jumpToToday();
        setInterval(checkReminder, 60000);
    };

    function checkReminder() {
        if (!reminderTime) return;
        const now = new Date();
        const currentTime = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        if (currentTime === reminderTime) {
            new Notification("  专\"!", { body: "砖专! 注  驻专拽 .", icon: "icon.png" });
        }
    }

    function requestNotificationPermission() {
        Notification.requestPermission().then(p => { if (p === "granted") alert("注! 转专转 驻注."); });
    }

    function updateReminderTime(v) { reminderTime = v; localStorage.setItem('rambamReminder', v); }

    function init() {
        const books = [...new Set(rambamData.map(i => i.b))];
        [document.getElementById('bookSelect'), document.getElementById('syncBook')].forEach(s => {
            books.forEach(b => { let o = document.createElement('option'); o.value = b; o.text = "住驻专 " + b; s.add(o); });
        });
        updateHalacha(); updateSyncHalacha();
    }

    function updateHalacha() {
        const b = document.getElementById('bookSelect').value;
        const hSel = document.getElementById('halachaSelect'); hSel.innerHTML = "";
        rambamData.filter(i => i.b === b).forEach(i => {
            let o = document.createElement('option'); o.value = i.h; o.text = "转 " + i.h; hSel.add(o);
        });
        render();
    }

    function updateSyncHalacha() {
        const b = document.getElementById('syncBook').value;
        const hSel = document.getElementById('syncHalacha'); hSel.innerHTML = "";
        rambamData.filter(i => i.b === b).forEach(i => {
            let o = document.createElement('option'); o.value = i.h; o.text = "转 " + i.h; hSel.add(o);
        });
        updateSyncPerekList();
    }

    function updateSyncPerekList() {
        const b = document.getElementById('syncBook').value;
        const h = document.getElementById('syncHalacha').value;
        const pSel = document.getElementById('syncPerekSelect'); pSel.innerHTML = "";
        const unit = rambamData.find(i => i.b === b && i.h === h);
        if (unit) { for (let i = 1; i <= unit.c; i++) { let o = document.createElement('option'); o.value = i; o.text = "驻专拽 " + getGematria(i); pSel.add(o); } }
    }

    function syncFromLocation() {
        const b = document.getElementById('syncBook').value;
        const h = document.getElementById('syncHalacha').value;
        const p = parseInt(document.getElementById('syncPerekSelect').value);
        let global = 0;
        for (let i of rambamData) { if (i.b === b && i.h === h) { global += p; break; } global += i.c; }
        const days = Math.ceil((global - 1) / pace);
        const d = new Date(); d.setHours(0,0,0,0); d.setDate(d.getDate() - days);
        localStorage.setItem('rambamStart', d.toISOString().split('T')[0]);
        location.reload();
    }

    function jumpToToday() {
        const start = new Date(localStorage.getItem('rambamStart'));
        const today = new Date(); today.setHours(0,0,0,0);
        const diffDays = Math.floor((today - start) / 86400000);
        const target = (diffDays * pace) + 1;
        let c = 0;
        for (let i of rambamData) { if (target <= c + i.c) { document.getElementById('bookSelect').value = i.b; updateHalacha(); document.getElementById('halachaSelect').value = i.h; break; } c += i.c; }
        render();
    }

    function render() {
        const start = new Date(localStorage.getItem('rambamStart'));
        const today = new Date(); today.setHours(0,0,0,0);
        const diffDays = Math.floor((today - start) / 86400000);
        const target = (diffDays * pace) + 1;
        document.getElementById('dayDisplay').innerText = diffDays + 1;
        document.getElementById('totalDisplay').innerText = completed.length + "/1000";
        document.getElementById('progressBar').style.width = (completed.length / 10) + "%";
        const lag = target - completed.length;
        const gMsg = document.getElementById('gapMsg');
        if (lag > 0) { gMsg.innerText = `驻专: ${lag} 驻专拽`; gMsg.style.color = "var(--danger)"; }
        else if (lag < 0) { gMsg.innerText = `拽: ${Math.abs(lag)} 驻专拽!`; gMsg.style.color = "var(--success)"; }
        else { gMsg.innerText = "拽爪 拽! 砖专"; gMsg.style.color = "var(--success)"; }
        const b = document.getElementById('bookSelect').value;
        const h = document.getElementById('halachaSelect').value;
        document.getElementById('listTitle').innerText = h;
        let html = ""; let gc = 0;
        for (let i of rambamData) {
            if (i.b === b && i.h === h) {
                for (let p = 1; p <= i.c; p++) {
                    const idx = gc + p;
                    const done = completed.includes(idx);
                    const isT = idx >= target && idx < target + pace;
                    const link = `https://www.sefaria.org.il/Mishneh_Torah%2C_${i.s}.${p}?lang=he`;
                    html += `<div class="chapter-item ${done?'completed':''} ${isT?'is-target':''}">
                        <input type="checkbox" ${done?'checked':''} onclick="toggle(${idx})">
                        <span class="chapter-label">驻专拽 ${getGematria(p)}</span>
                        <a href="${link}" target="_blank" class="btn-learn"></a>
                    </div>`;
                } break;
            } gc += i.c;
        }
        document.getElementById('chapterList').innerHTML = html;
    }

    function toggle(i) {
        let p = completed.indexOf(i); if(p > -1) completed.splice(p, 1); else completed.push(i);
        localStorage.setItem('rambamDone', JSON.stringify(completed)); render();
    }

    function markAllDone() {
        const b = document.getElementById('bookSelect').value;
        const h = document.getElementById('halachaSelect').value;
        if(!confirm(`住 转  转 ${h} ?`)) return;
        let gc = 0;
        rambamData.forEach(item => { for(let p=1; p<=item.c; p++) { gc++; if(item.b === b && item.h === h && !completed.includes(gc)) completed.push(gc); } });
        localStorage.setItem('rambamDone', JSON.stringify(completed)); render();
    }

    function toggleSettings() { let s = document.getElementById('settings').style; s.display = s.display==='block'?'none':'block'; }
    function updatePace(v) { pace = parseInt(v); localStorage.setItem('rambamPace', pace); render(); }
    function updateStartDate(v) { localStorage.setItem('rambamStart', v); render(); }
    function exportData() {
        const d = { start: localStorage.getItem('rambamStart'), done: completed, pace: pace };
        const b = new Blob([JSON.stringify(d)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'rambam_backup.json'; a.click();
    }
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
</script>
</body>
</html>
